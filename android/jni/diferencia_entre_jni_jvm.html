<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JVM vs JNI - Arquitectura</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #ffffff;
            color: #000000;
            padding: 40px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 40px;
            font-size: 32px;
            border-bottom: 3px solid #000;
            padding-bottom: 15px;
        }

        .architecture {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 60px;
        }

        .jvm-box {
            border: 3px solid #000;
            padding: 30px;
            position: relative;
        }

        .jvm-title {
            position: absolute;
            top: -15px;
            left: 20px;
            background: #fff;
            padding: 0 10px;
            font-weight: bold;
            font-size: 20px;
        }

        .jvm-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .component {
            border: 2px solid #000;
            padding: 15px;
            background: #f5f5f5;
        }

        .component-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-decoration: underline;
        }

        .jni-layer {
            border: 3px dashed #000;
            padding: 20px;
            text-align: center;
            font-weight: bold;
            background: repeating-linear-gradient(
                45deg,
                #fff,
                #fff 10px,
                #f0f0f0 10px,
                #f0f0f0 20px
            );
        }

        .arrow {
            text-align: center;
            font-size: 24px;
            margin: 10px 0;
        }

        .native-layer {
            border: 3px solid #000;
            padding: 20px;
            text-align: center;
            background: #e0e0e0;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 60px 0;
        }

        .comparison-box {
            border: 2px solid #000;
            padding: 20px;
        }

        .comparison-box h2 {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000;
        }

        .comparison-item {
            margin: 15px 0;
            padding: 10px;
            background: #f5f5f5;
            border-left: 4px solid #000;
        }

        .comparison-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .flow-diagram {
            border: 2px solid #000;
            padding: 30px;
            margin: 40px 0;
        }

        .flow-title {
            text-align: center;
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 30px;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }

        .flow-number {
            width: 40px;
            height: 40px;
            border: 2px solid #000;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .flow-content {
            flex: 1;
            margin-left: 20px;
            padding: 15px;
            border: 1px solid #000;
            background: #f9f9f9;
        }

        .code-box {
            background: #f0f0f0;
            border: 1px solid #000;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }

        .metaphor {
            border: 3px double #000;
            padding: 30px;
            margin: 40px 0;
            text-align: center;
        }

        .metaphor-title {
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 20px;
        }

        .metaphor-content {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-top: 20px;
        }

        .metaphor-box {
            padding: 20px;
            border: 2px solid #000;
            background: #f5f5f5;
        }

        .key-points {
            border: 2px solid #000;
            padding: 25px;
            margin: 40px 0;
        }

        .key-points h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        .key-point {
            margin: 15px 0;
            padding: 15px;
            background: #f5f5f5;
            border-left: 6px solid #000;
        }

        @media (max-width: 768px) {
            .jvm-content {
                grid-template-columns: 1fr;
            }
            
            .comparison {
                grid-template-columns: 1fr;
            }
            
            .metaphor-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>JVM vs JNI: Arquitectura y Funcionamiento</h1>

        <div class="architecture">
            <div class="jvm-box">
                <div class="jvm-title">JVM (Java Virtual Machine)</div>
                <div class="jvm-content">
                    <div class="component">
                        <div class="component-title">Clases Java/Kotlin</div>
                        <div>‚Ä¢ Bytecode ejecutable</div>
                        <div>‚Ä¢ Objetos en memoria</div>
                        <div>‚Ä¢ M√©todos y campos</div>
                    </div>
                    <div class="component">
                        <div class="component-title">Heap & GC</div>
                        <div>‚Ä¢ Gesti√≥n de memoria</div>
                        <div>‚Ä¢ Garbage Collector</div>
                        <div>‚Ä¢ Referencias de objetos</div>
                    </div>
                    <div class="component">
                        <div class="component-title">Thread Scheduler</div>
                        <div>‚Ä¢ Gesti√≥n de hilos</div>
                        <div>‚Ä¢ Sincronizaci√≥n</div>
                        <div>‚Ä¢ Context switching</div>
                    </div>
                    <div class="component">
                        <div class="component-title">Exception Handler</div>
                        <div>‚Ä¢ Manejo de excepciones</div>
                        <div>‚Ä¢ Stack traces</div>
                        <div>‚Ä¢ Try-catch blocks</div>
                    </div>
                </div>
            </div>

            <div class="arrow">‚ñº‚ñº‚ñº</div>

            <div class="jni-layer">
                JNI (Java Native Interface)<br>
                API de comunicaci√≥n bidireccional<br>
                JNIEnv* - Tabla de funciones
            </div>

            <div class="arrow">‚ñº‚ñº‚ñº</div>

            <div class="native-layer">
                <strong>C√≥digo Nativo (C/C++)</strong><br>
                pthread_create, malloc, punteros directos<br>
                Librer√≠as del sistema (.so)
            </div>
        </div>

        <div class="comparison">
            <div class="comparison-box">
                <h2>JVM</h2>
                <div class="comparison-item">
                    <div class="comparison-label">¬øQu√© es?</div>
                    M√°quina virtual que ejecuta c√≥digo Java/Kotlin
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Nivel</div>
                    Entorno de ejecuci√≥n completo
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Responsabilidad</div>
                    Ejecutar bytecode, gestionar memoria, hilos y excepciones
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Persistencia</div>
                    Vive durante toda la aplicaci√≥n
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Creaci√≥n</div>
                    Android crea una JVM (ART/Dalvik) por app
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Analog√≠a</div>
                    üè† La "casa" donde vive el c√≥digo Java
                </div>
            </div>

            <div class="comparison-box">
                <h2>JNI</h2>
                <div class="comparison-item">
                    <div class="comparison-label">¬øQu√© es?</div>
                    Interfaz/puente de comunicaci√≥n
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Nivel</div>
                    API dentro de la JVM
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Responsabilidad</div>
                    Permitir que C/C++ llame funciones Java y viceversa
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Persistencia</div>
                    Cada hilo tiene su JNIEnv* propio
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Creaci√≥n</div>
                    Parte de la JVM, accedido via JNIEnv*
                </div>
                <div class="comparison-item">
                    <div class="comparison-label">Analog√≠a</div>
                    üìû El "tel√©fono" para hablar con la casa
                </div>
            </div>
        </div>

        <div class="flow-diagram">
            <div class="flow-title">Flujo de Comunicaci√≥n: Kotlin ‚Üí C++ ‚Üí Java</div>
            
            <div class="flow-step">
                <div class="flow-number">1</div>
                <div class="flow-content">
                    <strong>C√≥digo Kotlin declara funci√≥n nativa</strong>
                    <div class="code-box">external fun startNativeThread()</div>
                </div>
            </div>

            <div class="flow-step">
                <div class="flow-number">2</div>
                <div class="flow-content">
                    <strong>JVM llama a librer√≠a .so y pasa JNIEnv*</strong>
                    <div class="code-box">JNIEnv* env = current_thread_jni_env;</div>
                </div>
            </div>

            <div class="flow-step">
                <div class="flow-number">3</div>
                <div class="flow-content">
                    <strong>C++ recibe JNIEnv* (puntero a tabla de funciones JNI)</strong>
                    <div class="code-box">JNIEXPORT void JNICALL<br>Java_com_example_Native_startNativeThread(JNIEnv *env, jobject thiz)</div>
                </div>
            </div>

            <div class="flow-step">
                <div class="flow-number">4</div>
                <div class="flow-content">
                    <strong>C++ usa JNI para invocar m√©todo Java</strong>
                    <div class="code-box">env->CallVoidMethod(thiz, methodID, args...);</div>
                </div>
            </div>

            <div class="flow-step">
                <div class="flow-number">5</div>
                <div class="flow-content">
                    <strong>JNI traduce la llamada a instrucciones de la JVM</strong>
                    <div class="code-box">// Internamente JNI ejecuta:<br>JVM::InvokeMethod(thiz, methodID, args);</div>
                </div>
            </div>

            <div class="flow-step">
                <div class="flow-number">6</div>
                <div class="flow-content">
                    <strong>JVM ejecuta el m√©todo Java y retorna resultado</strong>
                    <div class="code-box">fun callback() { println("Llamado desde C++") }</div>
                </div>
            </div>
        </div>

        <div class="metaphor">
            <div class="metaphor-title">Met√°fora Visual</div>
            <div class="metaphor-content">
                <div class="metaphor-box">
                    <strong>JVM</strong><br><br>
                    El MOTOR<br>
                    que ejecuta Java<br>
                    y controla la memoria
                </div>
                <div style="font-size: 30px;">‚ü∑</div>
                <div class="metaphor-box">
                    <strong>JNI</strong><br><br>
                    El PANEL DE CONTROL<br>
                    para manipular ese motor<br>
                    desde C/C++
                </div>
            </div>
        </div>

        <div class="key-points">
            <h2>Puntos Clave</h2>
            
            <div class="key-point">
                <strong>‚ñ∏ Sin JVM, JNI no puede existir</strong><br>
                JNI es una API que forma parte de la JVM, no es independiente
            </div>

            <div class="key-point">
                <strong>‚ñ∏ Sin JNI, C/C++ no puede hablar con Java</strong><br>
                El c√≥digo nativo necesita JNI para acceder a objetos y m√©todos Java
            </div>

            <div class="key-point">
                <strong>‚ñ∏ JNIEnv* es espec√≠fico por hilo</strong><br>
                Cada thread nativo que quiera llamar Java necesita su propio JNIEnv*
            </div>

            <div class="key-point">
                <strong>‚ñ∏ JNI es un overhead de rendimiento</strong><br>
                Cada llamada JNI tiene un costo de marshalling de datos entre mundos
            </div>

            <div class="key-point">
                <strong>‚ñ∏ La JVM maneja memoria Java, C++ maneja memoria nativa</strong><br>
                Los objetos creados con NewGlobalRef deben liberarse manualmente
            </div>
        </div>

    </div>
</body>
</html>