<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compilar y Distribuir LibrerÃ­as .so con Gradle</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            color: #000000;
            line-height: 1.6;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #000;
        }
        
        h2 {
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #000;
            font-size: 1.5em;
        }
        
        .intro {
            background: #f5f5f5;
            border: 2px solid #000;
            padding: 25px;
            margin-bottom: 40px;
        }
        
        .step {
            background: white;
            border: 2px solid #000;
            padding: 25px;
            margin: 25px 0;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .step-number {
            background: #000;
            color: #fff;
            width: 45px;
            height: 45px;
            line-height: 45px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.3em;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .step-title {
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .code-block {
            font-family: 'Courier New', Consolas, Monaco, monospace;
            background: #f5f5f5;
            padding: 15px;
            margin: 15px 0;
            border: 1px solid #ddd;
            border-left: 3px solid #000;
            overflow-x: auto;
            white-space: pre-wrap;
            line-height: 1.5;
            font-size: 0.9em;
        }
        
        code {
            font-family: 'Courier New', Consolas, Monaco, monospace;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
        
        .explanation {
            background: #e8e8e8;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #000;
        }
        
        .tip {
            background: #fff9c4;
            border: 2px solid #000;
            padding: 15px;
            margin: 20px 0;
        }
        
        .tip-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: block;
        }
        
        .file-tree {
            background: #fafafa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 0.9em;
        }
        
        .flow {
            background: #f9f9f9;
            border: 2px solid #000;
            padding: 20px;
            margin: 25px 0;
        }
        
        .flow-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .arrow {
            text-align: center;
            font-size: 2em;
            margin: 10px 0;
            color: #000;
        }
        
        .distribution-box {
            background: white;
            border: 2px solid #000;
            padding: 20px;
            margin: 20px 0;
        }
        
        .distribution-box h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .warning {
            background: #ffebee;
            border-left: 4px solid #c62828;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: #e8f5e9;
            border-left: 4px solid #2e7d32;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ“¦ Compilar y Distribuir LibrerÃ­as .so con Gradle</h1>
    
    <div class="intro">
        <h2 style="border: none; margin-top: 0;">ğŸ¯ El Proceso Completo</h2>
        <p style="margin: 15px 0; font-size: 1.1em;">
            <strong>Fase 1:</strong> Compilar cÃ³digo nativo (C/C++) â†’ Genera archivos <code>.so</code><br>
            <strong>Fase 2:</strong> Copiar <code>.so</code> a <code>jniLibs/</code><br>
            <strong>Fase 3:</strong> Distribuir la librerÃ­a a otras apps
        </p>
    </div>
    
    <h2>ğŸ”¨ PARTE 1: Compilar la LibrerÃ­a Nativa</h2>
    
    <div class="step">
        <div class="step-header">
            <div class="step-number">1</div>
            <div class="step-title">Limpiar y Compilar</div>
        </div>
        
        <pre class="code-block"><code># Ir al directorio raÃ­z del proyecto
cd /Users/kenny/Projects/AndroidStudioProjects/app-mobile-libraries-jdk11/rtsp-viewer-library

# Limpiar build anterior (opcional pero recomendado)
./gradlew :rtsp-viewer-library:clean

# Compilar SOLO la parte nativa (mÃ¡s rÃ¡pido)
./gradlew :rtsp-viewer-library:externalNativeBuildDebug</code></pre>
        
        <div class="explanation">
            <strong>ğŸ’¡ Â¿QuÃ© hace cada comando?</strong><br>
            â€¢ <code>:rtsp-viewer-library:clean</code> â†’ Borra builds anteriores del mÃ³dulo<br>
            â€¢ <code>:rtsp-viewer-library:externalNativeBuildDebug</code> â†’ Compila C/C++ usando CMake/NDK<br><br>
            <strong>Variantes:</strong><br>
            â€¢ <code>externalNativeBuildDebug</code> â†’ VersiÃ³n de desarrollo (con sÃ­mbolos de debug)<br>
            â€¢ <code>externalNativeBuildRelease</code> â†’ VersiÃ³n optimizada para producciÃ³n
        </div>
        
        <div class="tip">
            <span class="tip-title">âš¡ CompilaciÃ³n completa (si necesitas todo):</span>
            <pre class="code-block"><code># Compila TODO: Java/Kotlin + nativo + genera AAR
./gradlew :rtsp-viewer-library:assembleDebug</code></pre>
        </div>
    </div>
    
    <div class="step">
        <div class="step-header">
            <div class="step-number">2</div>
            <div class="step-title">Localizar los .so Generados</div>
        </div>
        
        <pre class="code-block"><code># Buscar TODOS los .so en el proyecto
find . -name "*.so" -type f

# Buscar solo en el mÃ³dulo especÃ­fico
find ./rtsp-viewer-library -name "*.so" -type f

# Ver directamente la ubicaciÃ³n esperada
ls -la rtsp-viewer-library/build/intermediates/cmake/debug/obj/arm64-v8a/</code></pre>
        
        <div class="explanation">
            <strong>ğŸ“ Ubicaciones tÃ­picas de los .so generados:</strong>
            <div class="file-tree">
rtsp-viewer-library/
â””â”€â”€ build/
    â””â”€â”€ intermediates/
        â””â”€â”€ cmake/
            â”œâ”€â”€ debug/          â† VersiÃ³n debug
            â”‚   â””â”€â”€ obj/
            â”‚       â”œâ”€â”€ arm64-v8a/    â† 64-bit ARM (mayorÃ­a de dispositivos modernos)
            â”‚       â”‚   â””â”€â”€ libgstreamer-native.so
            â”‚       â”œâ”€â”€ armeabi-v7a/  â† 32-bit ARM (dispositivos antiguos)
            â”‚       â”œâ”€â”€ x86/          â† Emuladores x86
            â”‚       â””â”€â”€ x86_64/       â† Emuladores x86 de 64-bit
            â””â”€â”€ release/        â† VersiÃ³n release
                â””â”€â”€ obj/
                    â””â”€â”€ ...
            </div>
        </div>
        
        <div class="tip">
            <span class="tip-title">ğŸ¯ ABIs (Arquitecturas) comunes:</span>
            â€¢ <strong>arm64-v8a</strong> â†’ Todos los dispositivos modernos (2015+)<br>
            â€¢ <strong>armeabi-v7a</strong> â†’ Dispositivos antiguos (pre-2015)<br>
            â€¢ <strong>x86_64</strong> â†’ Emuladores en PC/Mac Intel<br>
            â€¢ <strong>x86</strong> â†’ Emuladores antiguos (32-bit)
        </div>
    </div>
    
    <div class="step">
        <div class="step-header">
            <div class="step-number">3</div>
            <div class="step-title">Copiar a jniLibs/</div>
        </div>
        
        <pre class="code-block"><code># Crear estructura de directorios
mkdir -p rtsp-viewer-library/src/main/jniLibs/arm64-v8a
mkdir -p rtsp-viewer-library/src/main/jniLibs/armeabi-v7a

# Copiar .so para arm64-v8a (64-bit)
cp rtsp-viewer-library/build/intermediates/cmake/debug/obj/arm64-v8a/libgstreamer-native.so \
   rtsp-viewer-library/src/main/jniLibs/arm64-v8a/

# Copiar .so para armeabi-v7a (32-bit)
cp rtsp-viewer-library/build/intermediates/cmake/debug/obj/armeabi-v7a/libgstreamer-native.so \
   rtsp-viewer-library/src/main/jniLibs/armeabi-v7a/</code></pre>
        
        <div class="explanation">
            <strong>ğŸ—‚ï¸ Estructura final deseada:</strong>
            <div class="file-tree">
rtsp-viewer-library/
â””â”€â”€ src/
    â””â”€â”€ main/
        â”œâ”€â”€ java/              â† Tu cÃ³digo Java/Kotlin
        â”œâ”€â”€ jniLibs/           â† LibrerÃ­as nativas (.so)
        â”‚   â”œâ”€â”€ arm64-v8a/
        â”‚   â”‚   â””â”€â”€ libgstreamer-native.so
        â”‚   â”œâ”€â”€ armeabi-v7a/
        â”‚   â”‚   â””â”€â”€ libgstreamer-native.so
        â”‚   â”œâ”€â”€ x86_64/
        â”‚   â””â”€â”€ x86/
        â””â”€â”€ AndroidManifest.xml
            </div>
        </div>
        
        <div class="success">
            <strong>âœ… Â¡Listo!</strong> Ahora tu mÃ³dulo incluye las librerÃ­as nativas.
            Cuando compiles el AAR, los <code>.so</code> se empaquetarÃ¡n automÃ¡ticamente.
        </div>
    </div>
    
    <div class="tip">
        <span class="tip-title">ğŸ”„ Script automatizado (opcional):</span>
        <pre class="code-block"><code>#!/bin/bash
# copy-so.sh - Automatiza la copia de .so

BUILD_TYPE="debug"  # o "release"
SRC="rtsp-viewer-library/build/intermediates/cmake/$BUILD_TYPE/obj"
DST="rtsp-viewer-library/src/main/jniLibs"

for ABI in arm64-v8a armeabi-v7a; do
    mkdir -p "$DST/$ABI"
    cp "$SRC/$ABI/libgstreamer-native.so" "$DST/$ABI/"
    echo "âœ… Copiado $ABI"
done</code></pre>
        Ejecutar con: <code>bash copy-so.sh</code>
    </div>
    
    <h2>ğŸ“¤ PARTE 2: Distribuir a Otras Apps</h2>
    
    <div class="flow">
        <div class="flow-title">ğŸ¯ Hay 3 formas de distribuir:</div>
        <ol style="padding-left: 25px; margin-top: 10px;">
            <li><strong>AAR (Android Archive)</strong> â†’ Empaqueta todo (Java + .so + recursos)</li>
            <li><strong>Maven Local</strong> â†’ Publicar en repositorio local de tu mÃ¡quina</li>
            <li><strong>Maven Remoto</strong> â†’ Subir a repositorio privado/pÃºblico (GitHub Packages, etc.)</li>
        </ol>
    </div>
    
    <div class="distribution-box">
        <h3>ğŸ“¦ OpciÃ³n 1: Generar AAR (mÃ¡s simple)</h3>
        
        <pre class="code-block"><code># Generar el archivo AAR
./gradlew :rtsp-viewer-library:assembleRelease

# UbicaciÃ³n del AAR generado:
# rtsp-viewer-library/build/outputs/aar/rtsp-viewer-library-release.aar</code></pre>
        
        <div class="explanation">
            <strong>ğŸ“ El AAR contiene:</strong><br>
            â€¢ Clases compiladas (.class â†’ .dex)<br>
            â€¢ LibrerÃ­as nativas (.so) de todas las arquitecturas<br>
            â€¢ Recursos (layouts, drawables, etc.)<br>
            â€¢ AndroidManifest.xml<br>
            â€¢ ProGuard rules
        </div>
        
        <h4 style="margin-top: 25px; margin-bottom: 15px;">Usar el AAR en otra app:</h4>
        
        <div class="file-tree">
mi-otra-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ libs/                          â† Crear esta carpeta
â”‚   â”‚   â””â”€â”€ rtsp-viewer-library-release.aar
â”‚   â””â”€â”€ build.gradle
â””â”€â”€ settings.gradle
        </div>
        
        <pre class="code-block"><code>// app/build.gradle

android {
    // ...
}

dependencies {
    // Agregar el AAR como dependencia
    implementation files('libs/rtsp-viewer-library-release.aar')
    
    // Dependencias que necesite tu librerÃ­a (si las hay)
    implementation 'androidx.appcompat:appcompat:1.6.1'
}</code></pre>
        
        <pre class="code-block"><code>// Cargar la librerÃ­a nativa en tu cÃ³digo Java/Kotlin

class MainActivity : AppCompatActivity() {
    companion object {
        init {
            System.loadLibrary("gstreamer-native")  // Sin el prefijo "lib" ni extensiÃ³n ".so"
        }
    }
    
    // Declarar mÃ©todos nativos
    private external fun nativeInit(): Boolean
}</code></pre>
    </div>
    
    <div class="distribution-box">
        <h3>ğŸ  OpciÃ³n 2: Maven Local (desarrollo/testing)</h3>
        
        <h4>Paso 1: Configurar publishing en la librerÃ­a</h4>
        <pre class="code-block"><code>// rtsp-viewer-library/build.gradle

plugins {
    id 'com.android.library'
    id 'maven-publish'
}

android { /* ... */ }

afterEvaluate {
    publishing {
        publications {
            release(MavenPublication) {
                from components.release
                groupId = 'com.tuempresa'
                artifactId = 'rtsp-viewer-library'
                version = '1.0.0'
            }
        }
    }
}</code></pre>
        
        <h4>Paso 2: Publicar en Maven Local</h4>
        <pre class="code-block"><code># Publicar la librerÃ­a en ~/.m2/repository/
./gradlew :rtsp-viewer-library:publishToMavenLocal</code></pre>
        
        <h4>Paso 3: Usar desde otra app</h4>
        <pre class="code-block"><code>// settings.gradle de la app consumidora

dependencyResolutionManagement {
    repositories {
        mavenLocal()  // â† Agregar esto
        google()
        mavenCentral()
    }
}</code></pre>
        
        <pre class="code-block"><code>// app/build.gradle

dependencies {
    implementation 'com.tuempresa:rtsp-viewer-library:1.0.0'
}</code></pre>
    </div>
    
    <div class="distribution-box">
        <h3>â˜ï¸ OpciÃ³n 3: Maven Remoto (producciÃ³n)</h3>
        
        <div class="explanation">
            <strong>Repositorios comunes:</strong><br>
            â€¢ <strong>GitHub Packages</strong> â†’ Gratis para repos pÃºblicos<br>
            â€¢ <strong>Maven Central</strong> â†’ Requiere registro, proceso largo<br>
            â€¢ <strong>JitPack</strong> â†’ SÃºper fÃ¡cil, desde GitHub directamente<br>
            â€¢ <strong>Artifactory/Nexus</strong> â†’ Empresarial, privado
        </div>
        
        <h4>Ejemplo con JitPack (mÃ¡s fÃ¡cil):</h4>
        
        <pre class="code-block"><code>// 1. Subir tu cÃ³digo a GitHub
// 2. Crear un release (tag) en GitHub: v1.0.0

// 3. En la app consumidora:

// settings.gradle
dependencyResolutionManagement {
    repositories {
        maven { url 'https://jitpack.io' }
    }
}

// app/build.gradle
dependencies {
    implementation 'com.github.tuusuario:rtsp-viewer-library:1.0.0'
}</code></pre>
        
        <div class="tip">
            <span class="tip-title">ğŸ“– MÃ¡s info sobre JitPack:</span>
            â€¢ Solo necesitas cÃ³digo en GitHub<br>
            â€¢ Soporta release tags automÃ¡ticamente<br>
            â€¢ No requiere configuraciÃ³n compleja<br>
            â€¢ URL: <code>https://jitpack.io</code>
        </div>
    </div>
    
    <h2>ğŸ”§ ConfiguraciÃ³n Adicional en build.gradle</h2>
    
    <div class="step">
        <div class="step-title" style="margin-bottom: 15px;">Filtrar ABIs (reducir tamaÃ±o del APK)</div>
        
        <pre class="code-block"><code>// rtsp-viewer-library/build.gradle

android {
    defaultConfig {
        // Solo incluir arquitecturas que necesites
        ndk {
            abiFilters 'arm64-v8a', 'armeabi-v7a'
            // Excluye x86, x86_64 si no usas emuladores en producciÃ³n
        }
    }
    
    // O filtrar por build type
    buildTypes {
        release {
            ndk {
                abiFilters 'arm64-v8a'  // Solo 64-bit en release
            }
        }
        debug {
            ndk {
                abiFilters 'arm64-v8a', 'x86_64'  // Incluir emulador en debug
            }
        }
    }
}</code></pre>
    </div>
    
    <div class="step">
        <div class="step-title" style="margin-bottom: 15px;">Splits de APK por ABI (APKs separados)</div>
        
        <pre class="code-block"><code>// app/build.gradle (en la app que CONSUME la librerÃ­a)

android {
    splits {
        abi {
            enable true
            reset()
            include 'arm64-v8a', 'armeabi-v7a'
            universalApk false  // No generar APK universal (mÃ¡s pequeÃ±o)
        }
    }
}</code></pre>
        
        <div class="explanation">
            <strong>ğŸ¯ Resultado:</strong> Genera APKs separados por arquitectura<br>
            â€¢ <code>app-arm64-v8a-release.apk</code> (solo 64-bit)<br>
            â€¢ <code>app-armeabi-v7a-release.apk</code> (solo 32-bit)<br>
            Google Play automÃ¡ticamente entrega el APK correcto a cada dispositivo
        </div>
    </div>
    
    <h2>âœ… VerificaciÃ³n Final</h2>
    
    <div class="step">
        <div class="step-title" style="margin-bottom: 15px;">Comprobar que el .so estÃ¡ incluido</div>
        
        <pre class="code-block"><code># Ver contenido del AAR (es un archivo ZIP)
unzip -l rtsp-viewer-library/build/outputs/aar/rtsp-viewer-library-release.aar

# DeberÃ­as ver algo como:
# jni/arm64-v8a/libgstreamer-native.so
# jni/armeabi-v7a/libgstreamer-native.so

# Extraer y verificar
unzip rtsp-viewer-library-release.aar -d /tmp/aar-extracted
ls -la /tmp/aar-extracted/jni/*/</code></pre>
    </div>
    
    <div class="step">
        <div class="step-title" style="margin-bottom: 15px;">Verificar en APK instalado</div>
        
        <pre class="code-block"><code># DespuÃ©s de instalar tu app en el dispositivo
adb shell run-as com.tu.paquete ls -la lib/

# DeberÃ­as ver:
# libgstreamer-native.so</code></pre>
    </div>
    
    <div class="warning">
        <strong>âš ï¸ Problemas comunes:</strong><br><br>
        <strong>1. UnsatisfiedLinkError:</strong> El .so no estÃ¡ en jniLibs/ o nombre incorrecto<br>
        <strong>2. "No implementation found":</strong> Falta mÃ©todo nativo en C/C++ o JNI signature incorrecta<br>
        <strong>3. App crash al cargar:</strong> ABI incompatible (ej: solo arm64 pero dispositivo es armeabi-v7a)<br>
        <strong>4. AAR vacÃ­o:</strong> Olvidaste copiar .so a jniLibs/ antes de assembleRelease
    </div>
    
    <div class="success" style="margin-top: 30px; font-size: 1.1em;">
        <strong>ğŸ‰ Â¡Proceso completo!</strong><br><br>
        <strong>Resumen:</strong><br>
        1. Compilar nativo â†’ <code>externalNativeBuildDebug</code><br>
        2. Copiar .so a <code>src/main/jniLibs/</code><br>
        3. Generar AAR â†’ <code>assembleRelease</code><br>
        4. Distribuir â†’ AAR directo, Maven Local, o Maven Remoto<br>
        5. Cargar en cÃ³digo â†’ <code>System.loadLibrary("nombre")</code>
    </div>
</body>
</html>